<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.4.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Matteo Lisi">

  
  
  
    
  
  <meta name="description" content="In the study of human perception we often need to measure how sensitive is an observer to a stimulus variation, and how her/his sensitivity changes due to changes in the context or experimental manipulations. In many applications this can be done by estimating the slope of the psychometric function1, a parameter that relates to the precision with which the observer can make judgements about the stimulus. A psychometric function is generally characterized by 2-3 parameters: the slope, the threshold (or criterion), and an optional lapse parameter, which indicate the rate at which attention lapses (i.">

  
  <link rel="alternate" hreflang="en-us" href="http://mlisi.xyz/post/model-averaging/">

  


  

  
  
  
  <meta name="theme-color" content="rgb(0, 136, 204)">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/obsidian.min.css" crossorigin="anonymous" title="hl-light">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/obsidian.min.css" crossorigin="anonymous" title="hl-dark" disabled>
      
    

    

    

  

  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Arapey:400,400i|Karla:400,700|Roboto+Mono&display=swap">
  

  
  
  
  <link rel="stylesheet" href="/css/academic.min.9f45dd836d66c6f521a01f3ae65afc82.css">

  

  
  
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-107105934-1', 'auto');
      
      ga('require', 'eventTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'urlChangeTracker');
      ga('send', 'pageview');
    </script>
    <script async src="https://www.google-analytics.com/analytics.js"></script>
    
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin="anonymous"></script>
    
  
  

  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="http://mlisi.xyz/post/model-averaging/">

  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="Matteo Lisi">
  <meta property="og:url" content="http://mlisi.xyz/post/model-averaging/">
  <meta property="og:title" content="Multi-model estimation of psychophysical parameters | Matteo Lisi">
  <meta property="og:description" content="In the study of human perception we often need to measure how sensitive is an observer to a stimulus variation, and how her/his sensitivity changes due to changes in the context or experimental manipulations. In many applications this can be done by estimating the slope of the psychometric function1, a parameter that relates to the precision with which the observer can make judgements about the stimulus. A psychometric function is generally characterized by 2-3 parameters: the slope, the threshold (or criterion), and an optional lapse parameter, which indicate the rate at which attention lapses (i."><meta property="og:image" content="http://mlisi.xyz/img/shademe.png">
  <meta property="twitter:image" content="http://mlisi.xyz/img/shademe.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2017-12-08T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2017-12-08T00:00:00&#43;00:00">
  

  


  





  <title>Multi-model estimation of psychophysical parameters | Matteo Lisi</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0 compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/"><img src="/img/shademe.png" alt="Matteo Lisi"></a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav mr-auto">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>/home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>/blog</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#misc"><span>/misc</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#publications"><span>/publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>/contact</span></a>
        </li>

        
        

      
      </ul>
      <ul class="navbar-nav ml-auto">
      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        

      </ul>

    </div>
  </div>
</nav>


  <article class="article" itemscope itemtype="http://schema.org/Article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1 itemprop="name">Multi-model estimation of psychophysical parameters</h1>

  

  
    



<meta content="2017-12-08 00:00:00 &#43;0000 UTC" itemprop="datePublished">
<meta content="2017-12-08 00:00:00 &#43;0000 UTC" itemprop="dateModified">

<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    <time>Dec 8, 2017</time>
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    12 min read
  </span>
  

  
  
  
  <span class="middot-divider"></span>
  <a href="/post/model-averaging/#disqus_thread"></a>
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/categories/r/">R</a>, <a href="/categories/data-analysis/">data-analysis</a>, <a href="/categories/psychophysics/">psychophysics</a></span>
  

  
    
<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=http://mlisi.xyz/post/model-averaging/&amp;text=Multi-model%20estimation%20of%20psychophysical%20parameters" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=http://mlisi.xyz/post/model-averaging/&amp;t=Multi-model%20estimation%20of%20psychophysical%20parameters" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook-f"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Multi-model%20estimation%20of%20psychophysical%20parameters&amp;body=http://mlisi.xyz/post/model-averaging/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=http://mlisi.xyz/post/model-averaging/&amp;title=Multi-model%20estimation%20of%20psychophysical%20parameters" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=Multi-model%20estimation%20of%20psychophysical%20parameters%20http://mlisi.xyz/post/model-averaging/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=http://mlisi.xyz/post/model-averaging/&amp;title=Multi-model%20estimation%20of%20psychophysical%20parameters" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>


  

</div>

    














  
</div>



  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      


<p>In the study of human perception we often need to measure how sensitive is an observer to a stimulus variation, and how her/his sensitivity changes due to changes in the context or experimental manipulations. In many applications this can be done by estimating the slope of the psychometric function<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>, a parameter that relates to the precision with which the observer can make judgements about the stimulus. A psychometric function is generally characterized by 2-3 parameters: the slope, the threshold (or criterion), and an optional lapse parameter, which indicate the rate at which attention lapses (i.e. <em>stimulus-independent</em> errors) occur.</p>
<p>As an example, consider the situation where an observer is asked to judge whether a signal (can be anything, from the orientation angle of a line on a screen, or the pitch of a tone, to the speed of a car or the approximate number of people in a crowd, etc.) is above or below a given reference value, call it zero. The experimenter presents the observers with many signals of different intensities, and the observer is asked to respond by making a binary choice (larger/smaller than the reference), under two different contextual conditions (before/after having a pint, with different headphones, etc.). These two conditions are expected to results in different sensitivity, and the experimenter is interested in estimating as precisely as possible the difference in sensitivity<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a>. The psychometric function for one observer in the two conditions might look like this (figure below).</p>
<div class="figure">
<img src="/img/psyfun.png" alt="Psychometric functions. Each points is a response (0 or 1 ; some vertical jitter is added for clarity), and the lines represent the fitted psychometric model (here a cumulative Gaussian psychometric function). The two facets of the plots represent the two different conditions. It can be seen that the precision seems to be different across conditions: judgements made under condition 2 are more variable, indicating reduced sensitivity. " style="width:70.0%" />
<p class="caption">Psychometric functions. Each points is a response (0 or 1 ; some vertical jitter is added for clarity), and the lines represent the fitted psychometric model (here a cumulative Gaussian psychometric function). The two facets of the plots represent the two different conditions. It can be seen that the precision seems to be different across conditions: judgements made under condition ‘2’ are more variable, indicating reduced sensitivity. </p>
</div>
<p>Our focus is on the psychometric slope, and we are not really interested in measuring the lapse rate; however it is still important to take lapses into account: it has been shown that not accounting for lapses can have a large influence on the estimates of the slope <span class="citation">(Wichmann and Hill 2001)</span>.</p>
<div id="the-problem-with-lapses" class="section level3">
<h3>The problem with lapses</h3>
<p>Different observer may lapse at quite different rates, and for some of them the lapse rate is probably so small that can be considered negligible. Also, we usually don’t have hypothesis about lapses, and about whether they should or should not vary across conditions. We can base our analysis on different assumptions about when the observers may have attention lapses:</p>
<ol style="list-style-type: decimal">
<li>they may never lapse (or they do so with a small, negligible frequency);</li>
<li>they may lapse at a fairly large rate, but the rate is assumed constant across conditions (reasonable, especially if conditions are randomly interleaved);</li>
<li>they may lapse with variable rate across conditions.</li>
</ol>
<p>These assumptions will lead to three different psychometric models. The number can increase if we consider also different functional forms of the relationship between stimulus and choice; here for simplicity I will consider only psychometric models based on the cumulative Gaussian function (equivalent to a <em>probit</em> analysis), <span class="math inline">\(\Phi (\frac{x-\mu}{\sigma}) = \frac{1}{2}\left[ {1 + {\rm{erf}}\left( {\frac{{x - \mu }}{{\sigma \sqrt 2 }}} \right)} \right]\)</span>, where the mean <span class="math inline">\(\mu\)</span> woud correspond to the threshold parameter, <span class="math inline">\(\sigma\)</span> to the slope, and <span class="math inline">\(x\)</span> is the stimulus intensity. In our case the first assumption (<em>zero lapses</em>) would lead to the simplest psychometric model <span class="math display">\[
\Psi (x, \mu_i, \sigma_i)= \Phi (\frac{x-\mu_i}{\sigma_i})
\]</span> where the subscript <span class="math inline">\(i\)</span> indicates that the values of both mean <span class="math inline">\(\mu_i\)</span> and slope <span class="math inline">\(\sigma_i\)</span> are specific to the condition <span class="math inline">\(i\)</span>. The second assumption (<em>fixed lapse rate</em>) could correspond to the model <span class="math display">\[
\Psi (x, \mu_i, \sigma_i, \lambda)= \lambda + (1-2\lambda) \Phi (\frac{x-\mu_i}{\sigma_i})
\]</span> where the parameter <span class="math inline">\(\lambda\)</span> correspond to the probability of the observer making a random error. Note that this is assumed to be fixed with respect to the condition (no subscript). Finally the last assumption (<em>variable lapse rate</em>) would suggests the model <span class="math display">\[
\Psi (x, \mu_i, \sigma_i, \lambda_i)= \lambda_i + (1-2\lambda_i) \Phi (\frac{x-\mu_i}{\sigma_i})
\]</span> where all the parameters are allowed to vary between conditions.</p>
<p>We have thus three different models, but we haven’t any prior information to decide which model is more likely to be correct in our case. Also, we acknowledge the fact that there are individual differences and each observer in our sample may conform to one of the three assumptions with equal probability. Hence, ideally, we would like to find a way to deal with lapses - and find the best estimates of the slope values <span class="math inline">\(\sigma_i\)</span> without committing to one of the three models.</p>
</div>
<div id="multi-model-inference" class="section level1">
<h1>Multi-model inference</h1>
<p>One possible solution to this problem is provided by a <em>multi-model</em>, or model averaging, approach <span class="citation">(Burnham and Anderson 2002)</span>. This requires calculating the <a href="https://en.wikipedia.org/wiki/Akaike_information_criterion">AIC (Akaike Information Criterion)</a><a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a> for each model and subjects, and then combine the estimates according to the Akaike weights of each model. To compute the Akaike weights one typically proceed by first transforming them into differences with respect to the AIC of the best candidate model (i.e. the one with lower AIC) <span class="math display">\[
{\Delta _m} = {\rm{AI}}{{\rm{C}}_m} - \min {\rm{AIC}}
\]</span> From the differences in AIC, we can obtain an estimate of the relative likelihood of the model <span class="math inline">\(m\)</span> given the data <span class="math display">\[
\mathcal{L} \left( {m|{\rm{data}}} \right) \propto \exp \left( { - \frac{1}{2}{\Delta _m}} \right)
\]</span> Then, to obtain the Akaike weight <span class="math inline">\(w_m\)</span> of the model <span class="math inline">\(m\)</span>, the relative likelihoods are normalized (divided by their sum) <span class="math display">\[
{w_m} = \frac{{\exp \left( { - \frac{1}{2}{\Delta _m}} \right)}}{{\mathop \sum \limits_{k = 1}^K \exp \left( { - \frac{1}{2}{\Delta _k}} \right)}}
\]</span> Finally, one can compute the model-averaged estimate of the parameter<a href="#fn4" class="footnoteRef" id="fnref4"><sup>4</sup></a>, <span class="math inline">\(\hat {\bar \sigma}\)</span>, by combining the estimate of each model according to their Akaike weight <span class="math display">\[
\hat {\bar \sigma} = \sum\limits_{k = 1}^K {{w_k}\hat \sigma_k } 
\]</span></p>
</div>
<div id="simulation-results" class="section level1">
<h1>Simulation results</h1>
<p>Model averaging seems a sensitive approach to deal with the uncertainty about which form of the model is best suited to our data. To see whether it is worth doing the extra work of fitting 3 models instead of just one, I run a simulation, where I repeatedly fit and compare the estimates of the three models, with the model-averaged estimate, for different values of sample sizes. In all the simulations, each observer is generated by randomly drawing parameters from a Gaussian distribution which summarize the distribution of the parameters in the population. Hence, I know the <em>true</em> difference in sensitivity in the population, and by simulating and fitting the models I can test which estimating procedure is more <em>efficient</em>. In statistics a procedure or an estimator is said to be more efficient than another one when it provides a better estimate with the same number or fewer observations. The notion of “better” clearly relies on the choice of a cost function, which for example can be the mean squared error (it is here).</p>
<p>Additionally, in my simulations each simulated observer could, <em>with equal probability</em> <span class="math inline">\(\frac{1}{3}\)</span>, either never lapse, lapse with a constant rate across conditions, or lapse at a higher rate in the more difficult condition (condition ‘2’ where the judgements are less precise). The lapse rates were draw uniformly from the interval [0.01, 0.1], and could get as high as 0.15 in condition ‘2’. Each simulated observer ran 250 trials per condition (similar to the figure at the top of this page). I simulated dataset from <span class="math inline">\(n=5\)</span> to <span class="math inline">\(n=50\)</span>, using 100 iterations for each sample size (only 85 in the case of <span class="math inline">\(n=50\)</span> because the simulation was taking too long and I needed my laptop for other stuff). For simplicity I assumed that the different parameters were not correlated across observers<a href="#fn5" class="footnoteRef" id="fnref5"><sup>5</sup></a>. I also had my simulated observer using the same criterion across the two conditions, although this may not necessarily be true. The quantity of interest here is the difference in slope between the two condition, that is <span class="math inline">\(\sigma_2 - \sigma_1\)</span>.</p>
<p>First, I examined the mean squared error of each of the models’ estimates, and of the model-averaged estimate. This is the average squared difference between the estimate and the true value. <img src="/img/mse.png" alt="" style="width:60.0%" /> The results shows (unless my color blindness fooled me) that the model-averaged estimate attains always the smaller error. Note also that the error tend to decrease exponentially with the sample size. Interestingly, the worst model seems to be the one that allow for the lapses to vary across conditions. This may be because the change in the lapse rate across condition was - when present - relatively small, but also because this model has a larger number of parameters, and thus produces more variable estimates (that is with higher standard errors) than smaller model. Indeed, given that I know the ‘true’ value of the parameres in this simulation settings, I can divide the error into the two subcomponents of variance and bias (see <a href="http://scott.fortmann-roe.com/docs/BiasVariance.html">this page</a> for a nice introduction to the bias-variance tradeoff). The bias is the difference between the expected estimate (averaged over many repetitions/iterations) of the same model and the true quantity that we want to estimate. The variance is simply the variability of the model estimates, i.e. how much they oscillate around the expected estimate.</p>
<p>Here is a plot of the variance. Indeed it can be seen that the variable-lapse model, which has more parameters, is the one that produces more variable estimates. There is however little difference between the other two models’ and the multi-model estimates <img src="/img/variance.png" alt="" style="width:60.0%" /></p>
<p>And here is the bias. This is very satisfactory, as it shows that while all individual models produced biased estimates, the bias of the model-averaged estimates is zero, or very close to zero. <img src="/img/bias.png" alt="" style="width:60.0%" /> In sum, by averaging models of different levels of complexity according to their relative likelihood, I was able to simultaneously minimize the variance and decrease the bias of my estimates, and achieve a greater efficiency. Model averaging seems to be the ideal procedure in this specific settings where the observer would belong to one of the three categories (i.e., she/he would conform to one of the three assumptions) with equal probability. However I think (although I haven’t checked) that it would perform well even in cases where a single “type” of observers is largely predominant over the other.</p>
</div>
<div id="code" class="section level1">
<h1>Code</h1>
<p>The (clumsy written) code for the simulations is shown below:</p>
<pre class="r"><code># This load some handy functions that are required below
library(RCurl)
script &lt;- getURL(&quot;https://raw.githubusercontent.com/mattelisi/miscR/master/miscFunctions.R&quot;, ssl.verifypeer = FALSE)
eval(parse(text = script))

set.seed(1)

# sim parameters
n_sim &lt;- 100
sample_sizes &lt;- seq(5, 100, 5)

# parameters
R &lt;- 3 # range of signal levels (-R, R)
n_trial &lt;- 500
mu_par &lt;- c(0, 0.25) # population (mean, std.)
sigma_par &lt;- c(1, 0.25)
sigmaDiff_par &lt;- c(1, 0.5)
lapse_range &lt;- c(0.01, 0.1)

# start
res &lt;- {}
for(n_subjects in sample_sizes){
for(iteration in 1:n_sim){  
    
    # make dataset
    d &lt;- {}
    for(i in 1:n_subjects){
        d_ &lt;- data.frame(x=runif(n_trial)*2*R-R, 
                    condition=as.factor(rep(1:2,n_trial/2)), 
                    id=i, r=NA)

        r_i &lt;- runif(1) # draw observer type (wrt lapses)

        if(r_i&lt;1/3){
            # no lapses
            par1 &lt;- c(rnorm(1,mu_par[1],mu_par[2]), 
                abs(rnorm(1,sigma_par[1],sigma_par[2])),
                0)
            par2 &lt;- c(par1[1], 
                par1[2]+abs(rnorm(1,sigmaDiff_par[1],sigmaDiff_par[2])),
                0) 

        }else if(r_i&gt;=1/3 &amp; r_i&lt;2/3){
            # fixed lapses
            l_i &lt;- runif(1)*diff(lapse_range) + lapse_range[1]
            par1 &lt;- c(rnorm(1,mu_par[1],mu_par[2]), 
                abs(rnorm(1,sigma_par[1],sigma_par[2])),
                l_i)
            par2 &lt;- c(par1[1], 
                par1[2]+abs(rnorm(1,sigmaDiff_par[1],sigmaDiff_par[2])), 
                l_i) 

        }else{
            # varying lapses
            l_i_1 &lt;- runif(1)*diff(lapse_range) + lapse_range[1]
            l_i_2 &lt;- l_i_1 + (runif(1)*diff(lapse_range) + lapse_range[1])/2
            par1 &lt;- c(rnorm(1,mu_par[1],mu_par[2]), 
                abs(rnorm(1,sigma_par[1],sigma_par[2])),
                l_i_1)
            par2 &lt;- c(par1[1], 
                par1[2]+abs(rnorm(1,sigmaDiff_par[1],sigmaDiff_par[2])), 
                l_i_2) 
        }

        ## simulate observer
        for(i in 1:sum(d_$condition==&quot;1&quot;)){
            d_$r[d_$condition==&quot;1&quot;][i] &lt;- rbinom(1,1,
                psy_3par(d_$x[d_$condition==&quot;1&quot;][i],par1[1],par1[2],par1[3]))
        }
        for(i in 1:sum(d_$condition==&quot;2&quot;)){
            d_$r[d_$condition==&quot;2&quot;][i] &lt;- rbinom(1,1,
                psy_3par(d_$x[d_$condition==&quot;2&quot;][i],par2[1],par2[2],par2[3]))
        }
        d &lt;- rbind(d,d_)
    }
    
    
    ## model fitting

    # lapse assumed to be 0
    fit0 &lt;- {}
    for(j in unique(d$id)){
        m0 &lt;- glm(r~x*condition, family=binomial(probit),d[d$id==j,])
        sigma_1 &lt;- 1/coef(m0)[2]
        sigma_2 &lt;- 1/(coef(m0)[2] + coef(m0)[4])
        fit0 &lt;- rbind(fit0, data.frame(id=j, sigma_1, sigma_2, 
                loglik=logLik(m0), aic=AIC(m0), model=&quot;zero_lapse&quot;) )
    }
    
    # fix lapse rate 
    start_p &lt;- c(rep(c(0,1),2), 0)
    l_b &lt;- c(rep(c(-5, 0.05),2), 0)
    u_b &lt;- c(rep(c(5, 20), 2), 0.5)
    fit1 &lt;- {}

    for(j in unique(d$id)){
        ftm &lt;- optimx::optimx(par = start_p, lnorm_3par_multi , 
                d=d[d$id==j,],  method=&quot;bobyqa&quot;, 
                lower =l_b, upper =u_b)
        
        negloglik &lt;- ftm$value
        aic &lt;- 2*5 + 2*negloglik
        # fitted parameters are the first n numbers of optimx output
        sigma_1&lt;-unlist(ftm [1,2])
        sigma_2&lt;-unlist(ftm [1,4])
        fit1 &lt;- rbind(fit1, data.frame(id=j, sigma_1, sigma_2, 
                loglik=-negloglik, aic, model=&quot;fix_lapse&quot;)  )
    }
    
    
    # varying lapse rate
    start_p &lt;- c(0,1, 0)
    l_b &lt;- c(-5, 0.05, 0)
    u_b &lt;- c(5, 20, 0.5)
    fit2 &lt;- {}
    for(j in unique(d$id)){
        # fit condition 1
        ftm &lt;- optimx::optimx(par = start_p, lnorm_3par , 
                d=d[d$id==j &amp; d$condition==&quot;1&quot;,],  
                method=&quot;bobyqa&quot;, lower =l_b, upper =u_b) 
        negloglik_1 &lt;- ftm$value; sigma_1 &lt;- unlist(ftm [1,2])
        # fit condition 2
        ftm &lt;- optimx::optimx(par = start_p, lnorm_3par , 
                d=d[d$id==j &amp; d$condition==&quot;2&quot;,],  
                method=&quot;bobyqa&quot;, lower =l_b, upper =u_b) 
        negloglik_2 &lt;- ftm$value; sigma_2 &lt;- unlist(ftm [1,2])

        aic &lt;- 2*6 + 2*(negloglik_1 + negloglik_2)
        fit2 &lt;- rbind(fit2, data.frame(id=j, sigma_1, sigma_2, 
                loglik=-negloglik_1-negloglik_2, aic, model=&quot;var_lapse&quot;))
    }
    
    # compute estimates of the change in slope
    effect_0 &lt;- mean((fit0$sigma_2-fit0$sigma_1))
    effect_1 &lt;- mean((fit1$sigma_2-fit1$sigma_1))
    effect_2 &lt;- mean((fit2$sigma_2-fit2$sigma_1))
    
    effect_av &lt;- {}
    for(j in unique(fit0$id)){
        dj &lt;- rbind(fit0[fit0$id==j,], fit1[fit1$id==j,], fit2[fit2$id==j,])
        min_aic &lt;- min(dj$aic)
        dj$delta &lt;- dj$aic - min_aic
        den &lt;- sum(exp(-0.5*c(dj$delta)))
        dj$w &lt;- exp(-0.5*dj$delta) / den
        effect_av &lt;- c(effect_av, sum((dj$sigma_2-dj$sigma_1) * dj$w))
    }
    effect_av &lt;- mean(effect_av)
    
    # store results
    res &lt;- rbind(res, data.frame(effect_0, effect_1, effect_2, 
            effect_av, effect_true=sigmaDiff_par[1], 
            n_subjects, n_trial, iteration))

}
}

## PLOT RESULTS
library(ggplot2)
library(reshape2)

res$err0 &lt;- (res$effect_0 -1)^2
res$err1 &lt;- (res$effect_1 -1)^2
res$err2 &lt;- (res$effect_2 -1)^2
res$errav &lt;- (res$effect_av -1)^2

# plot MSE
ares &lt;- aggregate(cbind(err0,err1,err2,errav)~n_subjects, res, mean)
ares &lt;- melt(ares, id.vars=c(&quot;n_subjects&quot;))
levels(ares$variable) &lt;- c(&quot;no lapses&quot;, &quot;fixed lapse rate&quot;, &quot;variable lapse rate&quot;, &quot;model averaged&quot;)
ggplot(ares,aes(x=n_subjects, y=value, color=variable))+geom_line(size=1)+nice_theme+scale_color_brewer(palette=&quot;Dark2&quot;,name=&quot;model&quot;)+labs(x=&quot;number of subjects&quot;,y=&quot;mean squared error&quot;)+geom_hline(yintercept=0,lty=2,size=0.2)

# plot variance
ares &lt;- aggregate(cbind(effect_0,effect_1,effect_2,effect_av)~n_subjects, res, var)
ares &lt;- melt(ares, id.vars=c(&quot;n_subjects&quot;))
levels(ares$variable) &lt;- c(&quot;no lapses&quot;, &quot;fixed lapse rate&quot;, &quot;variable lapse rate&quot;, &quot;model averaged&quot;)
ggplot(ares,aes(x=n_subjects, y=value, color=variable))+geom_line(size=1)+nice_theme+scale_color_brewer(palette=&quot;Dark2&quot;,name=&quot;model&quot;)+labs(x=&quot;number of subjects&quot;,y=&quot;variance&quot;)

# plot bias
ares &lt;- aggregate(cbind(effect_0,effect_1,effect_2,effect_av)~n_subjects, res, mean)
ares &lt;- melt(ares, id.vars=c(&quot;n_subjects&quot;))
levels(ares$variable) &lt;- c(&quot;no lapses&quot;, &quot;fixed lapse rate&quot;, &quot;variable lapse rate&quot;, &quot;model averaged&quot;)
ares$value &lt;- ares$value -1
ggplot(ares,aes(x=n_subjects, y=value, color=variable))+geom_hline(yintercept=0,lty=2,size=0.2)+geom_line(size=1)+nice_theme+scale_color_brewer(palette=&quot;Dark2&quot;,name=&quot;model&quot;)+labs(x=&quot;number of subjects&quot;,y=&quot;bias&quot;)</code></pre>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-Burnham2002">
<p>Burnham, Kenneth P., and David R. Anderson. 2002. <em>Model Selection and Multimodel Inference: A Practical Information-Theoretic Approach</em>. 2nd editio. New York, US: Springer New York. doi:<a href="https://doi.org/10.1007/b97636">10.1007/b97636</a>.</p>
</div>
<div id="ref-Wichmann2001">
<p>Wichmann, F a, and N J Hill. 2001. “The psychometric function: I. Fitting, sampling, and goodness of fit.” <em>Perception &amp; Psychophysics</em> 63 (8): 1293–1313. <a href="http://www.ncbi.nlm.nih.gov/pubmed/11800458" class="uri">http://www.ncbi.nlm.nih.gov/pubmed/11800458</a>.</p>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>The psychometric function is a statistical model that predicts the probabilities of the observer response (e.g. “stimulus A has a larger/smaller instensity than stimulus B”), conditional to the stimulus and the experimental condition.<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>A good experimenter should do that (estimate the size of the difference). A “bad” experimenter might just be interested in obtaining <span class="math inline">\(p&lt;.05\)</span>. See <a href="http://cerco.ups-tlse.fr/-Charte-statistique-?lang=fr">this page</a>, compiled by Jean-Michel Hupé, for some references and guidelines against <span class="math inline">\(p\)</span>-hacking and the misuse of statistical tools in neuroscience.<a href="#fnref2">↩</a></p></li>
<li id="fn3"><p>The AIC of a model is computed as <span class="math inline">\({\rm{AIC}} = 2k - 2\log \left( \mathcal{L} \right)\)</span>, where <span class="math inline">\(k\)</span> is the number of free parameters, and <span class="math inline">\(\mathcal{L}\)</span> is the maximum value of the likelihood function of that model.<a href="#fnref3">↩</a></p></li>
<li id="fn4"><p>Here it is a parameter common to all models. See the book of Burnham &amp; Andersen for methods to methods to deal with different situations <span class="citation">(Burnham and Anderson 2002)</span>.<a href="#fnref4">↩</a></p></li>
<li id="fn5"><p>Such correlation when present can be modelled using a mixed-effect approach. See my tutorial on mized-effects model in the<a href="http://mattelisi.github.io/#notes">‘misc’</a> section of this website.<a href="#fnref5">↩</a></p></li>
</ol>
</div>

    </div>

    


    

<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/r/">R</a>
  
  <a class="badge badge-light" href="/tags/psychophysics/">psychophysics</a>
  
</div>



    
      








  





  
  
  
    
  
  
  <div class="media author-card" itemscope itemtype="http://schema.org/Person">
    
      
      <img class="portrait mr-3" src="/authors/admin/avatar_hu132b73c7c53d8c33e2dc1920b7b984d0_146246_250x250_fill_q90_lanczos_center.jpg" itemprop="image" alt="Avatar">
    

    <div class="media-body">
      <h5 class="card-title" itemprop="name"><a href="http://mlisi.xyz/">Matteo Lisi</a></h5>
      
      
      <ul class="network-icon" aria-hidden="true">
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="/#contact" >
              <i class="fas fa-paper-plane"></i>
            </a>
          </li>
        
          
          
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://scholar.google.com/citations?user=IabbkbEAAAAJ&amp;hl" target="_blank" rel="noopener">
              <i class="ai ai-google-scholar"></i>
            </a>
          </li>
        
          
          
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="http://orcid.org/0000-0003-3554-385X" target="_blank" rel="noopener">
              <i class="ai ai-orcid"></i>
            </a>
          </li>
        
          
          
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="http://www.researchgate.net/profile/Matteo_Lisi" target="_blank" rel="noopener">
              <i class="ai ai-researchgate"></i>
            </a>
          </li>
        
          
          
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://publons.com/researcher/1636713/matteo-lisi/" target="_blank" rel="noopener">
              <i class="ai ai-publons"></i>
            </a>
          </li>
        
          
          
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://osf.io/gqy5f/" target="_blank" rel="noopener">
              <i class="ai ai-osf"></i>
            </a>
          </li>
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://github.com/mattelisi" target="_blank" rel="noopener">
              <i class="fab fa-github"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>



      
      
    

    

    
<section id="comments">
  
    
<div id="disqus_thread"></div>
<script>
  let disqus_config = function () {
    
    
    
  };
  (function() {
    if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
      document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
      return;
    }
    var d = document, s = d.createElement('script'); s.async = true;
    s.src = 'https://' + "mattelisi" + '.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


  
</section>



  </div>
</article>

      

    
    
    
    <script src="/js/mathjax-config.js"></script>
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js" integrity="sha256-aYTdUrn6Ow1DDgh5JTc3aDGnnju48y/1c8s1dgkYPQ8=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/r.min.js"></script>
        
      

      
      
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML-full" integrity="sha256-GhM+5JHb6QUzOQPXSJLEWP7R73CbkisjzK5Eyij4U9w=" crossorigin="anonymous" async></script>
      
    

    
    
      <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD12zE83xCTsL_ohYvAPoW43ZdpsvD_rGU"></script>
      
      <script src="https://cdnjs.cloudflare.com/ajax/libs/gmaps.js/0.4.25/gmaps.min.js" integrity="sha256-7vjlAeb8OaTrCXZkCNun9djzuB2owUsaO72kXaFDBJs=" crossorigin="anonymous"></script>
      
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    
    <script id="dsq-count-scr" src="https://mattelisi.disqus.com/count.js" async></script>
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.16bbb3750feb7244c9bc409a5a4fe678.js"></script>

    






  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    &copy; 2019 Matteo Lisi &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
